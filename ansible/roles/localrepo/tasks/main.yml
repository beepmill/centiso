---
- name: Ensure httpd is installed
  yum:
    name: httpd
    state: present
  become: yes
- name: Ensure top level directory for content exists
  file:
    path: /var/www/html/repos/centos/7.3.1611
    state: directory
  become: yes
- name: Ensure repo subdirectories exists
  file:
    path: /var/www/html/repos/centos/7.3.1611/{{ item }}/x86_64
    state: directory
  with_items:
    - os
    - updates
    - centosplus
    - extras
    - local
  become: yes
- name: Ensure release link exists
  file:
    path: /var/www/html/repos/centos/7
    src: /var/www/html/repos/centos/7.3.1611
    state: link
  become: yes
- name: Ensure firewall permits web traffic
  firewalld:
    service: http
    zone: public
    state: enabled
    immediate: yes
    permanent: yes
  become: yes
- name: Ensure web service is started and enabled at boot
  systemd:
    name: httpd
    state: started
    enabled: yes
  become: yes
- name: Ensure repo sync script is installed
  copy:
    dest: /usr/local/bin/syncrepos
    src: syncrepos
    owner: root
    group: root
    mode: 0750
  become: yes
- name: Ensure sync script excludes directory exists
  file:
    path: /etc/syncrepos/excludes
    state: directory
    owner: root
    group: root
    mode: 0755
  become: yes
- name: Ensure exclude lists are installed
  copy:
    dest: /etc/syncrepos/excludes/{{ item }}
    src: "{{ item }}"
    owner: root
    group: root
    mode: 0644
  with_items:
    - os.list
    - updates.list
    - centosplus.list
    - extras.list
  become: yes
